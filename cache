using System;
using System.Collections.Generic;
using Microsoft.Extensions.Caching.Memory;

public class CacheService
{
    private readonly IMemoryCache _cache;

    public CacheService(IMemoryCache cache)
    {
        _cache = cache;
    }

    public List<string> GetCachedList()
    {
        const string cacheKey = "MyListCache";

        if (_cache.TryGetValue(cacheKey, out List<string> cachedList))
        {
            Console.WriteLine("✅ Cache'den alındı!");
            return cachedList;
        }

        Console.WriteLine("⚙️ Cache boş, yeni liste oluşturuluyor...");
        var newList = new List<string> { "Elma", "Armut", "Muz", "Kivi" };

        var cacheOptions = new MemoryCacheEntryOptions()
            .SetAbsoluteExpiration(TimeSpan.FromMinutes(10)) // 10 dakika boyunca sakla
            .SetPriority(CacheItemPriority.Normal);           // Temizleme önceliği

        _cache.Set(cacheKey, newList, cacheOptions);

        return newList;
    }
}

[ApiController]
[Route("api/[controller]")]
public class ProductsController : ControllerBase
{
    private readonly CacheService _cacheService;

    public ProductsController(IMemoryCache cache)
    {
        _cacheService = new CacheService(cache);
    }

    [HttpGet("list")]
    public IActionResult GetProducts()
    {
        var products = _cacheService.GetCachedList();
        return Ok(products);
    }
}
